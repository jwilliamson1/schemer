#lang web-server/insta

(struct post (title body))

(define BLOG (list (post "first" "first entry")
(post "world ending" "we are doomed. Yay!")))


(define (render-post a-post)
  `(div ((class "post"))
        ,(post-title a-post)
        (p ,(post-body a-post))))

(define (render-posts a-blog)
  `(div ((class "posts"))
        ,@(map render-post a-blog)))

(define (start request)
  (render-blog-page BLOG request))

      
(define (render-blog-page a-blog request)
  (response/xexpr
   `(html
     (head (title "Scheme Test"))
     (body (h1 "scheming and running rackets")
           ,(render-posts a-blog)))))

;can-parse-post? : (bindings? . -> . boolean?)

(define (can-part-post? bindings)
 (and (exists-binding? 'title)
      (exists-binding? 'body)))

;parse-post : bindings -> post
(define (parse-post bindings)
  (post (extract-binding/single 'title)
        (extract-binding/single 'post)))

